# ［C++］4次方程式の解を求める（フェラーリの方法）

#### フェラーリの方法
[tex:ax^ 4+bx^ 3+cx^ 2+dx+e=0]の形の複二次式ではない4次方程式の解の公式を求める方法がフェラーリさんによって考案されたフェラーリの方法です。
これを導出してみます。

##### 1. 4次の係数を1にする
まず、4次の項の係数を1にします。全体を4次の係数[tex:a]で割ってやります。

<div>[tex:
\begin{aligned}
ax^ 4+bx^ 3+cx^ 2+dx+e&=\frac{a}{a}x^ 4+\frac{b}{a}x^ 3+\frac{c}{a}x^ 2+\frac{d}{a}x+\frac{e}{a}\\
&=x^ 4+\frac{b}{a}x^ 3+\frac{c}{a}x^ 2+\frac{d}{a}x+\frac{e}{a}\\
&=x^ 4+Ax^ 3+Bx^ 2+Cx+D
\end{aligned}
]</div>

3次以下の係数をA,B,C,Dと置きなおして次に進みます。

このように最高次の係数を1にした1変数多項式をモニック多項式と呼んだりします。

##### 2. 3次の項を削除する（チルンハウス変換）
次に、チルンハウス変換により3次の項の係数を0にします。3次項を消し去ります・・・。
[tex:x=y-\frac{A}{4}]と置換してやります。

<div>[tex:
\begin{aligned}
x^ 4+Ax^ 3+Bx^ 2+Cx+D&=\left(y-\frac{A}{4}\right)^ 4+A\left(y-\frac{A}{4}\right)^ 3+B\left(y-\frac{A}{4}\right)^ 2+C\left(y-\frac{A}{4}\right)+D{a}\\
&=y^ 4+\left(B-6\left(\frac{A}{4}\right)^ 2\right)y^ 2+\left(C-2B\frac{A}{4}+8\left(\frac{A}{4}\right)^ 3\right)y+D-C\frac{A}{4}+B\left(\frac{A}{4}\right)^ 2-3\left(\frac{A}{4}\right)^ 4\\
&=y^ 4+py^ 2+qy+r
\end{aligned}
]</div>

係数をp,q,rと置いて次に行きます。

###### チルンハウス変換
一般のn次方程式[tex:a _ nx^ n + a _ {n-1}x^ {n-1}+ ... + a _ 0 = 0]に対して[tex:x = y - \frac{a _ {n-1}}{na _ n}]のような変数変換を行うと、n-1次の係数を0にすることができます。これをチルンハウス変換と呼びます。

ちなみに、5次方程式で出てくるチルンハウス変換はこれを推し進めた結果4～2次までの項を消し去ることに成功した、少しハイレベルなチルンハウス変換です。結果として手計算がほぼ不可能になっているようですが・・・。

##### 3. 3次式にする
4次式のままだと相変わらず解けないので、何とかして式の次数を落とします。

式を右辺と左辺に分け、両辺を[tex:y]に関する完全平方式にすることを考えます。どういうことかというと、[tex: (y^ 2+t)^ 2 = (my+n)^ 2]の形にするのです。  
まず、[tex: (y^ 2+t)^ 2 = y^ 4+2ty^ 2+t^ 2]という公式を利用します。ここではまだ、[tex:t]は任意の数として具体的に決めないでおきます。

<div>[tex:
\begin{aligned}
y^ 4+py^ 2+qy+r&=0\\
y^ 4 &=-py^ 2-qy-r\\
y^ 4 +2ty^ 2+t^ 2&=-py^ 2-qy-r + 2ty^ 2+t^ 2\\
(y^ 2+t)^2&=(2t-p)y^ 2-qy+(t^ 2-r)
\end{aligned}
]</div>

4次の項だけを左辺に残して、両辺に[tex:2ty^ 2+t^ 2]を加えて変形していきます。結果、左辺は完全平方式になりましたが、右辺はまだそうなってはいません。右辺の式をよく見てみると[tex:y]に関する2次式になっています。

ところで、2次式が完全平方式になるためにはその判別式（[tex:D=b^ 2-4ac]）が0でなければならないという条件があります。そこで、その条件を満足するように[tex:t]の値を決めてやります。

<div>[tex:
\begin{aligned}
b^ 2-4ac&=(-q)^ 2-4(2t-p)(t^ 2-r)\\
&=q^ 2 -4(2t^ 3-2rt-pt^2+pr)\\
&=-\frac{1}{4}q^ 2 + 2t^ 3-2rt-pt^2+pr\\
&=2t^ 3-pt^2-2rt-\frac{1}{4}q^ 2+pr\\
&=t^ 3-\frac{1}{2}-pt^2-rt+\frac{1}{2}(-\frac{1}{4}q^ 2+pr)\\
t^ 3-\frac{1}{2}-pt^2-rt+\frac{1}{2}(-\frac{1}{4}q^ 2+pr) &=0
\end{aligned}
]</div>

と、このように[tex:t]に関しての3次方程式が出てきました。この3次方程式の3つの解のうち1つを選んで[tex:t]としてやれば、[tex:(-q)^ 2-4(2t-p)(t^ 2-r)=0]の条件を満たしているため先ほどの式の右辺を完全平方式[tex:(my+n)^ 2]の形に置き換えることができます（3次方程式の求解は[以前の記事](https://onihusube.hatenablog.com/entry/2018/10/08/140426)に投げます）。

そして、ここで得られた3次方程式のことを三次分解方程式と呼びます。

それでは右辺を完全平方式に変形します。途中で、[tex:x^ 2-2ax = (x-a)^ 2-a^ 2]という関係を使って式を変形します。

<div>[tex:
\begin{aligned}
(2t-p)y^ 2-qy+(t^ 2-r)&=(2t-p)\left(y^ 2-\frac{qy}{2t-p}+\frac{t^ 2-r}{2t-p} \right)\\
&=(2t-p)\left(y^ 2-2\frac{q}{2(2t-p)}y+\frac{t^ 2-r}{2t-p} \right)\\
&=(2t-p)\left(\left(y-\frac{q}{2(2t-p)}\right)^ 2-\left(\frac{q}{2(2t-p)}\right)^ 2+\frac{t^ 2-r}{2t-p} \right)\\
&=(2t-p)\left(\left(y-\frac{q}{2(2t-p)}\right)^ 2-\frac{q^ 2}{4(2t-p)^ 2}+\frac{t^ 2-r}{2t-p} \right)\\
&=(2t-p)\left(y-\frac{q}{2(2t-p)}\right)^ 2-\frac{q^ 2}{4(2t-p)}+(t^ 2-r)\\
&=(2t-p)\left(y-\frac{q}{2(2t-p)}\right)^ 2-\frac{1}{4(2t-p)}(q^ 2-4(2t-p)(t^ 2-r))\\
&=(2t-p)\left(y-\frac{q}{2(2t-p)}\right)^ 2-\frac{1}{4(2t-p)}\dot 0\\
&=(2t-p)\left(y-\frac{q}{2(2t-p)}\right)^ 2
\end{aligned}
]</div>

途中で判別式の[tex:q^ 2-4(2t-p)(t^ 2-r)=0]を利用して不要な項をまとめて消してしまっています。結果、完全平方式一歩手前のすっきりした式になりました。  
さらに変形して[tex:t, m]を求めてやりましょう。外に出ている[tex:(2t-p)]を何とかしてかっこの中に埋め込みます。

<div>[tex:
\begin{aligned}
(y^ 2+t)^2&=(2t-p)y^ 2-qy+(t^ 2-r)\\
&=(2t-p)\left(y-\frac{q}{2(2t-p)}\right)^ 2\\
&=(\sqrt{2t-p})^ 2\left(y-\frac{q}{2(2t-p)}\right)^ 2\\
&=\left((\sqrt{2t-p}) \left(y-\frac{q}{2(2t-p)}\right)\right)^ 2\\
&=\left(\sqrt{2t-p}y-\frac{q \sqrt{2t-p}}{2(2t-p)}\right)^ 2\\
&=(my+n)^ 2
\end{aligned}
]</div>

半ば無理やりかっこの中へ押し込み、[tex:(my+n)^ 2]の形に持っていきました。

ちなみに、[tex:t]を導入する時に係数を工夫（例えば[t=\frac{t'}{2}]）すると係数に分数とかが出てこなくなって比較的すっきりとした形になります。他サイトではそう書いてあることが多いです、結論は変わりませんが。

##### 4. 2次式へ
天下り的に4次式を両辺を[tex:y]に関する完全平方式の形に変換していましたが、なぜそのようなことをするのでしょうか？得られた完全平方式を変形してみると

<div>[tex:
\begin{aligned}
(y^ 2+t)^ 2&=(my+n^)^ 2\\
(y^ 2+t)^ 2-(my+n^)^ 2&=0\\
(y^ 2+t + my+n)(y^ 2+t - my -n)&=0\\
(y^ 2+my+t+n)(y^ 2-my+t-n)&=0
\end{aligned}
]</div>

2行目→3行目では、因数分解でよく出る二乗の公式（[tex:x^ 2-y^ 2=(x+y)(x-y)]）を使っています。  
このように二つの[tex:y]に関する2次方程式の積に変形することができます。この式が成り立つのはそれぞれの2次式が0になるとき、つまり[tex:y]がそれぞれの2次方程式の解となるときです。

遠回りをしてきたので印象薄いかもしれませんが、ここの[tex:y]はチルンハウス変換後の式[tex:y^ 4+py^ 2+qy+r]から来ています。つまり、この二つの2次式の解として求められる[tex:y]こそが欲しかった4次方程式の解となります。

2次方程式の解の公式は分かっているので（[tex:x=\frac{-b\pm \sqrt{b^2-4ac}}{2a}]）、それを利用すれば4次方程式の解の公式は以下のようになります。

<div>[tex:
\begin{aligned}
y_{1,2}&=\frac{-m\pm \sqrt{m^ 2-4(t+n)}}{2}\\
y_{3,4}&=\frac{m\pm \sqrt{m^ 2-4(t-n)}}{2}
\end{aligned}
]</div>

必要な係数[tex:m, t, n]はここまでですでに求まっていますので、この式は解くことができそうです。

##### 5. 得られた各値より解を求める
無事に[tex:y]が4つ得られたので、チルンハウス変換を解いて[tex:x=y-\frac{A}{4}]を求めてやりましょう。

<div>[tex:
\begin{aligned}
x_{1,2}&=y_{1,2} - \frac{A}{4}\\
x_{3,4}&=y_{3,4} - \frac{A}{4}
\end{aligned}
]</div>

このように、4次方程式の4つの解[tex:x]を求めることができました。しかし、式を展開していくととても解の公式とは言えないような式が出てきてしまいますね・・・

#### 判別式
3次以下の多項式に判別式があったように、4次方程式にも判別式があります。しかし、求めた式をパッと見ただけではどこを判別式として使用したらいいのかわかりません・・・

[Wikipediaによると](https://ja.wikipedia.org/wiki/判別式)4次方程式の判別式は以下のようになります（[tex:a=1,b=0]としてここで求めた式に合わせて係数も置き換えています）。

<div>[tex:
\begin{aligned}
D&=256r^ 3-128p^ 2r^ 2+144pq^ 2r-27r^ 4+16p^ 4r-4q^3r^2
\end{aligned}
]</div>

この[tex:D]は3次以下の時と同じように
- [tex:D=0] : 少なくとも二つの解が重複。それが複素数ならば、その共役も重複。
- [tex:D>0] : 2組の互いに共役な複素数解
- [tex:D<0] : 2つの実数解と互いに共役な複素数解

となります。

解の様子がどうなるかは分かりますが、この式はここで求めた解の公式（の各項）との関連が見られず、計算したとしても使いまわせないので今回の実装においては使用しないことにします。  
解の公式が2次方程式の形で得られているので、2次方程式の判別式を代わりに利用していきます。

#### 一部の係数が0になる場合

##### 複二次式
[tex:ax^ 4+bx^ 3+cx^ 2+dx+e]という形の4次方程式に対して、奇数次の項の係数[tex:b,d]が0になっている形の4次方程式[tex:ax^ 4+cx^ 2+e]を複二次式と呼びます。

複二次式は[tex:x^ 2]についての二次方程式と見ることで簡単に解くことができます。

[tex:y = x^ 2]とおいてやると[tex:ay^ 2+cy+e]となるので、二次方程式の解の公式を適用してやると

[tex:y=\frac{-c \pm \sqrt{c^ 2 -4ae} }{2a}]

<div>[tex:
\begin{aligned}
x&=\sqrt{y}\\
&=\sqrt{\frac{-c \pm \sqrt{c^ 2 -4ae} }{2a}}
\end{aligned}
]</div>

この様に、簡単に解を求めることができます。

4次方程式には4つの解がありますが、複二次式の場合は二次方程式を解いた解が2つ出てきて、最後に平方根を求めるところでそれぞれ最大2つの解が得られます。

求めた[tex:y^ 4+py^ 2+qy+r=0]の場合は、[tex:q=0]のときに[tex:y^ 4+py^ 2+r=0]となって、[tex:y = z^ 2]と置いてやれば同じように、[tex:\sqrt{\frac{-p \pm \sqrt{p^ 2 -4r} }{2}}]と求めることができます。

##### [tex:r=0]の場合
[tex:y^ 4+py^ 2+qy+r=0]の[tex:r=0]の場合も式を簡単にすることができます。

<div>[tex:
\begin{aligned}
y^ 4+py^ 2+qy+0.0&=y^ 4+py^ 2+qy\\
&=y(y^ 3+py+q)
\end{aligned}
]</div>

となり、解は[tex:y=0]と[tex:y^ 3+py+q]の3つの解となります。

#### C++実装


#### 参考文献
- [四次方程式 - Wikipedia](https://ja.wikipedia.org/wiki/%E5%9B%9B%E6%AC%A1%E6%96%B9%E7%A8%8B%E5%BC%8F)
- [四次方程式の解法 - 雨男の巣窟](https://blog.rainyman.jp/nest/?p=321)
- [４次方程式解の公式 - Fukusukeの数学めも](https://mathsuke.jp/ferrari_formula/)
- [四次方程式](http://www.geocities.co.jp/HeartLand-Himawari/3613/engine/mp0204.html)