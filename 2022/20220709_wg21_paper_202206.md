# ［C++］WG21月次提案文書を眺める（2022年05月）

文書の一覧

- [JTC1/SC22/WG21 - Papers 2022 mailing2022-06](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/#mailing2022-06)

全部で46本あります。

[:contents]


### [P0009R17 MDSPAN](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0009r17.html)
### [P0429R9 A Standard flat_map](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0429r9.pdf)
### [P0447R20 Introduction of std::hive to the standard library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0447r20.html)
### [P0792R10 function_ref: a non-owning reference to a Callable](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0792r10.html)
### [P0957R8 Proxy: A Polymorphic Programming Library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p0957r8.pdf)
### [P1018R16 C++ Language Evolution status - pandemic edition – 2022/02-2022/06](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1018r16.html)
### [P1144R6 Object relocation in terms of move plus destroy](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1144r6.html)
### [P1222R4 A Standard flat_set](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1222r4.pdf)
### [P1223R5 find_last](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1223r5.pdf)
### [P1642R10 Freestanding Library: Easy [utilities], [ranges], and [iterators]](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1642r10.html)
### [P1673R9 A free function linear algebra interface based on the BLAS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1673r9.html)
### [P1689R5 Format for describing dependencies of source files](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1689r5.html)
### [P1774R8 Portable assumptions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1774r8.pdf)
### [P1839R5 Accessing object representations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1839r5.pdf)
### [P1967R7 #embed - a simple, scannable preprocessor-based resource acquisition method](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1967r7.html)
### [P2167R2 Improved Proposed Wording for LWG 2114 (contextually convertible to bool)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2167r2.html)
### [P2278R4 cbegin should always return a constant iterator](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2278r4.html)
### [P2490R3 Zero-overhead exception stacktraces](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2490r3.html)
### [P2502R2 std::generator: Synchronous Coroutine Generator for Ranges](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2502r2.pdf)
### [P2505R3 Monadic Functions for std::expected](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2505r3.html)
### [P2505R4 Monadic Functions for std::expected](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2505r4.html)
### [P2513R3 char8_t Compatibility and Portability Fix](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2513r3.html)
### [P2551R2 Clarify intent of P1841 numeric traits](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2551r2.pdf)
### [P2562R1 constexpr Stable Sorting](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2562r1.pdf)
### [P2570R0 On side effects in contract annotations](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2570r0.html)

コントラクト注釈に指定された条件式が副作用を持つ場合にどうするかについて、議論をまとめた文書。

この文書は[P2182](https://wg21.link/p2182)で定義されているMVPと呼ばれるコントラクトの最小セットをベースとして、コントラクト注釈に指定されている条件式が副作用を持つ場合に標準としてどう規定するかの現在の議論や方向性についてまとめたものです。

この文書で提示されている副作用に対する選択肢は以下の3つです

- 条件式が副作用を持たないことを証明できない場合、コンパイルエラーとする
- Cの`assert`マクロのモデルを使用する
    - 一方のモード（*Eval and abort*）では副作用を評価し、一方のモード（*No eval*）では評価しない
- *Eval and abort*モードでは、条件式を複数回評価することを許可する
    - 副作用の信頼性を低下させる

*Eval and abort*モードは、契約条件を評価し破られた（`false`となった）場合にはプログラムを終了させる実行モードで、*No eval*モードは全ての契約条件を無視する実行モードです。契約違反ハンドリングや契約違反後の続行モードは、C++20コントラクトの際に炎上した部分であるので、MVPには含まれていません。

現在のSG21の方向性としては、MVPをまず標準に導入してからそこに機能を追加していくことを目指しているため、MVPの部分（この文書の範囲も含めて）は将来の拡張について開いているようにしようとしています。そのため、次のような指針があります

- 物議をかもしている部分（機能）について何らかのセマンティクスを指定することは避けようとしている
    - 2つの可能な将来の方向性がある場合、どちらに対してもオープンである事を目指す
- 定義したくない部分については、UB/IF-NDRよりもill-formedにする
    - プログラマに実行時の驚きを与えることを回避し、構文スペースを節約する
- 未規定や実装定義として指定するよりも、UBとして定義する
    - 将来的にプラットフォーム間で統一されたセマンティクスを提供し、その部分をill-formedにすることができるようにしておく

そしてSG21は、コントラクトは安全性を向上させるための機能であるとして機能そのものもより安全なものにしようとしています。とはいえ、この文書で扱われている副作用をはじめとしてC++の危険な側面を多く含んでいるため、コントラクトについては他のC++の部分とは異なる効率性と安全性のトレードオフを取らざるを得ない部分があります。その場合でも、契約条件についてC++の他のところと同様に扱う、などの統一性の要求を重視しない方針です。

- [P2182R0 : Contract Support: Defining the Minimum Viable Feature Set - WG21月次提案文書を眺める（2020年6月）](https://onihusube.hatenablog.com/entry/2020/07/05/003248#P2182R0--Contract-Support-Defining-the-Minimum-Viable-Feature-Set)

### [P2572R0 std::format() fill character allowances](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2572r0.html)
### [P2575R0 2022-05 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2575r0.html)
### [P2582R1 Wording for class template argument deduction from inherited constructors](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2582r1.pdf)
### [P2590R1 Explicit lifetime management](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2590r1.pdf)
### [P2591R1 Concatenation of strings and string views](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2591r1.html)
### [P2594R0 Slides: Allow programmer to control and detect coroutine elision (P2477R2 Presentation))](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2594r0.pdf)
### [P2596R0 Improve std::hive::reshape](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2596r0.html)
### [P2598R0 “Changing scope for lambda trailing-return-type” (P2036) should not be a DR](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2598r0.html)
### [P2599R0 mdspan::size_type should be index_type](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r0.pdf)
### [P2599R1 mdspan::size_type should be index_type](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r1.pdf)
### [P2599R2 index _type & size_type in mdspan](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2599r2.pdf)
### [P2600R0 A minimal ADL restriction to avoid ill-formed template instantiation](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2600r0.pdf)
### [P2601R0 To make redundant empty angle brackets optional for class template argument lists](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2601r0.html)
### [P2602R0 Poison Pills are Too Toxic](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2602r0.html)
### [P2603R0 member function pointer to function pointer](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2603r0.html)
### [P2604R0 MDSPAN: rename pointer and contiguous](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2604r0.html)
### [P2605R0 SG16: Unicode meeting summaries 2022-01-12 through 2022-06-08](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2605r0.html)
### [P2607R0 Let alignas specify minimum alignment](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2607r0.html)
### [P2608R0 Allow multiple init-statements](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2608r0.html)
### [P2609R0 Relaxing Ranges Just A Smidge](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2609r0.html)
### [P2613R0 Add the missing `empty` to `mdspan`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2613r0.html)