# ［C++］WG21月次提案文書を眺める（2023年08月）

文書の一覧

- [JTC1/SC22/WG21 - Papers 2022 mailing2023-10](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/#mailing2023-10)

全部で80本あります。

もくじ

[:contents]

### [N4961 2024-03 Tokyo meeting information](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4961.pdf)

2024年3月末に東京で行われるWG21全体会議の案内。

### [N4962 WG21 agenda: 6-11 November 2023, Kona, HI](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4962.html)

2023年11月にハワイのコナで行われるWG21全体会議のアジェンダ。

### [N4963 2023 WG21 admin telecon meetings, rev. 2](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4963.pdf)

11月の全体会議に先立って行われる、WG21管理者ミーティングの案内。

### [N4964 Working Draft, Programming Languages -- C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4964.pdf)

C++26のワーキングドラフト第2弾

### [N4965 Editors' Report, Programming Languages -- C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4965.html)

↑の変更点をまとめた文書。

新規に採択された提案はなく、編集上の変更のみです。また、C++23 DISに対するNBコメントの対応についても記されています。

### [P0447R23 Introduction of std::hive to the standard library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p0447r23.html)
### [P0876R14 fiber_context - fibers without scheduler](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p0876r14.pdf)
### [P0952R1 A new specification for `std::generate_canonical`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p0952r1.html)

`std::generate_canonical`の仕様を改善する提案。

[`std::generate_canonical`](https://cpprefjp.github.io/reference/random/generate_canonical.html)の現在の規定は、浮動小数点数の仕様を無視しているため誤って制約されています。それによって実質的に正しい実装が不可能になっています。この提案では主に2つの問題について指摘しています。

この関数の動作は次の3つの要件に従うはずです

1. 結果は`[0, 1)`に入らなければならない
2. アルゴリズムは正確に指定されており、使用する`URBG`は指定された引数に対して特定の固定回数だけ呼び出される必要がある
3. 結果は一様分布となる

1つ目の問題は、これらの要件を満たしながらの実装が不可能である点です。現在の規定は、要件2を満たすように正確に数式によって指定されており、結果である`S/Rk`は数学的には1未満の値を返します。しかし、浮動小数点数によってこの式が実行される場合、丸めによってこの結果は正確に`1`になる場合があります。このことは、`generate_canonical`から取得した`x`に対して`(1.0 - x)`で除算している場合にバグを引き起こします。

すなわち、現在の規定では要件2を満たそうとすると、要件1に違反します。結果が`1`になってしまった場合に結果を修正しようとすれば要件3に違反します。要件1と3を満たすようにすると、結果が`1`となる場合にアルゴリズムを再実行する必要があり、それは要件2に違反します。

2つ目の問題は、除算と浮動小数点丸め（最近接偶数丸め）が組み合わさることで出力が均一とならない場合があることです。例えば、`0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5`という値に対して丸めを行うことを考える場合、最下位ビットを切り捨てれば`0, 0, 1, 1, 2, 2, 3, 3`となりこれは一様ですが、浮動小数点数において一般的な最近接偶数丸めを行うと`0, 0, 1, 2, 2, 2, 3, 4`となり偶数と奇数のバランスに偏りが生じる他、0にもバイアスが生じています。

これと同じことが`std::generate_canonical`の計算の過程で発生し、最下位ビットあるいはその周辺の数ビットにおいて結果のバイアスが生じることで最終的な結果の均一性が失われます（この辺りの説明はこの記事を書いている人が理解できていないので、提案の方を参照されるといいと思います・・・）。

この提案は、この2つの問題を`std::generate_canonical`のインターフェースを変更することなく解決するために、アルゴリズムや計算量についての規定を変更することで改善しようとするものです。

この提案は一部の引数の解釈やアルゴリズムそのものを変更することによって、non-trivial divisionを使用せず再近接偶数丸めの問題を回避しようとしています。そのため、副作用や計算量が変化し、また、同じ入力から生成される乱数列も変更前と異なることになります。そのため、それらに依存する既存のコードの動作は実行時に壊れます。

ただし、この提案では`std::generate_canonical`の結果が区間`[0, 1)`内で`RealType`の表現可能な全ての値が含むようにすることは、定義が困難かつ実装が複雑化するとして行っていません。

- [`std::generate_canonical` - cpprefjp](https://cpprefjp.github.io/reference/random/generate_canonical.html)
- [`[0.0, 1.0)` の乱数を得るための“本当の”方法](https://speakerdeck.com/hole/rand01)
- [単精度浮動小数点数 - FC2](https://ieyasu03.web.fc2.com/Computer/CUDA/04_float.html)
- [P0952 進行状況](https://github.com/cplusplus/papers/issues/574)

### [P1144R9 std::is_trivially_relocatable](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p1144r9.html)
### [P1729R3 Text Parsing](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p1729r3.html)
### [P1928R7 std::simd - Merge data-parallel types from the Parallelism TS 2](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p1928r7.pdf)
### [P2019R4 Thread attributes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2019r4.pdf)
### [P2075R3 Philox as an extension of the C++ RNG engines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2075r3.pdf)
### [P2267R0 Library Evolution Policies](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2267r0.html)
### [P2447R5 std::span over an initializer list](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2447r5.html)
### [P2500R2 C++ parallel algorithms and P2300](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2500r2.html)
### [P2542R6 views::concat](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2542r6.html)
### [P2642R4 Padded mdspan layouts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2642r4.html)
### [P2663R4 Proposal to support interleaved complex values in std::simd](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2663r4.html)
### [P2664R4 Proposal to extend std::simd with permutation API](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2664r4.html)
### [P2717R3 Tool Introspection](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2717r3.html)
### [P2762R2 Sender/Receiver Interface For Networking](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2762r2.pdf)
### [P2774R1 Concurrent object pool (was: Scoped thread-local storage)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2774r1.pdf)
### [P2786R3 Trivial Relocatability For C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2786r3.pdf)
### [P2800R0 Dependency flag soup needs some fiber](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2800r0.html)
### [P2809R2 Trivial infinite loops are not Undefined Behavior](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2809r2.html)
### [P2841R1 Concept Template Parameters](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2841r1.pdf)
### [P2845R3 Formatting of std::filesystem::path](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2845r3.html)
### [P2845R3 Formatting of std::filesystem::path](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2845r4.html)
### [P2862R1 text_encoding::name() should never return null values](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2862r1.html)
### [P2863R2 Review Annex D for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2863r2.html)
### [P2885R3 Requirements for a Contracts syntax](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2885r3.pdf)
### [P2893R1 Variadic Friends](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2893r1.pdf)
### [P2897R1 aligned_accessor: An mdspan accessor expressing pointer overalignment](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2897r1.html)
### [P2900R0 Contracts for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2900r0.pdf)
### [P2900R1 Contracts for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2900r1.pdf)
### [P2911R1 Python Bindings with Value-Based Reflection](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2911r1.pdf)
### [P2927R0 Observing exceptions stored in exception_ptr](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2927r0.html)
### [P2932R1 A Principled Approach to Open Design Questions for Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2932r1.pdf)
### [P2935R3 An Attribute-Like Syntax for Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2935r3.pdf)
### [P2959R0 Container Relocation](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2959r0.html)
### [P2961R1 A natural syntax for Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2961r1.pdf)
### [P2962R0 Communicating the Baseline Compile Command for C++ Modules support](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2962r0.pdf)
### [P2967R0 Relocation Is A Library Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2967r0.pdf)
### [P2971R1 Implication for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2971r1.pdf)
### [P2978R0 A New Approach For Compiling C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2978r0.html)
### [P2979R0 The Need for Design Policies in WG21](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2979r0.pdf)
### [P2980R0 A motivation, scope, and plan for a physical quantities and units library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2980r0.html)
### [P2981R0 Improving our safety with a physical quantities and units library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2981r0.html)
### [P2982R0 std::quantity as a numeric type](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2982r0.html)
### [P2984R0 Reconsider Redeclaring static constexpr Data Members](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2984r0.html)
### [P2985R0 A type trait for detecting virtual base classes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2985r0.html)
### [P2986R0 Generic Function Pointer](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2986r0.html)
### [P2988R0 std::optional<T&>](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2988r0.html)
### [P2989R0 A Simple Approach to Universal Template Parameters](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2989r0.pdf)
### [P2990R0 C++ Modules Roadmap](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2990r0.html)
### [P2991R0 Stop Forcing std::move to Pessimize](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2991r0.html)
### [P2992R0 Attribute [[discard]] and attributes on expressions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2992r0.html)
### [P2994R0 On the Naming of Packs](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2994r0.html)
### [P2995R0 SG16: Unicode meeting summaries 2023-05-24 through 2023-09-27](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2995r0.html)
### [P2996R0 Reflection for C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2996r0.html)
### [P2997R0 Removing the common reference requirement from the indirectly invocable concepts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2997r0.html)
### [P2999R0 Sender Algorithm Customization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2999r0.html)
### [P3001R0 std::hive and containers like it are not a good fit for the standard library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3001r0.html)
### [P3002R0 Guidelines for allocators in new library classes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3002r0.pdf)
### [P3003R0 The design of a library of number concepts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3003r0.pdf)
### [P3008R0 Atomic floating-point min/max](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3008r0.html)
### [P3009R0 Injected class name in the base specifier list](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3009r0.pdf)
### [P3010R0 Using Reflection to Replace a Metalanguage for Generating JS Bindings](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3010r0.pdf)
### [P3011R0 Supporting document for Hive proposal #1: outreach for evidence of container-style use in industry](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3011r0.pdf)
### [P3012R0 Supporting document for Hive proposal #2: use of std::list in open source codebases](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3012r0.pdf)
### [P3014R0 Customizing std::expected's exception](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3014r0.html)
### [P3015R0 Rebuttal to Additional format specifiers for time_point](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3015r0.html)
### [P3016R0 Resolve inconsistencies in begin/end for valarray and braced initializer lists](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3016r0.html)
### [P3018R0 Low-Level Integer Arithmetic](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3018r0.pdf)
### [P3019R0 Vocabulary Types for Composite Class Design](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3019r0.pdf)
### [P3020R0 2023-09 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3020r0.html)
### [P3021R0 Unified function call syntax (UFCS)](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3021r0.pdf)
### [P3022R0 A Boring Thread Attributes Interface](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3022r0.html)
### [P3023R0 C++ Should Be C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p3023r0.html)
