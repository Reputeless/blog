# ［C++］WG21月次提案文書を眺める（2024年01月）

文書の一覧

- [JTC1/SC22/WG21 - Papers 2024 mailing2024-01](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/#mailing2024-01)

全部で22本あります。

もくじ

[:contents]

### [P1255R11 A view of 0 or 1 elements: views::maybe](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1255r11.pdf)
### [P1255R12 A view of 0 or 1 elements: views::maybe](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1255r12.pdf)
### [P1709R5 Graph Library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p1709r5.pdf)
### [P2019R5 Thread attributes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2019r5.pdf)
### [P2527R3 std::variant_alternative_index and std::tuple_element_index](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2527r3.html)
### [P2664R6 Proposal to extend std::simd with permutation API](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2664r6.html)
### [P2748R3 Disallow Binding a Returned Glvalue to a Temporary](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2748r3.html)
### [P2748R4 Disallow Binding a Returned Glvalue to a Temporary](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2748r4.html)
### [P2835R2 Expose std::atomic_ref's object address](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2835r2.html)
### [P2894R2 Constant evaluation of Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2894r2.pdf)
### [P2900R4 Contracts for C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2900r4.pdf)
### [P2932R3 A Principled Approach to Open Design Questions for Contracts](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2932r3.pdf)
### [P2946R1 A flexible solution to the problems of `noexcept`](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2946r1.pdf)
### [P2957R1 Contracts and coroutines](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2957r1.html)
### [P2963R1 Ordering of constraints involving fold expressions](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2963r1.pdf)
### [P2988R1 std::optional<T&>](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p2988r1.pdf)
### [P3044R0 sub-string_view from string](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3044r0.pdf)

`std::string`から直接`string_view`を取得する関数を追加する提案。


文字列の非所有参照（ビュー）として`std:string_view`がC++17で標準ライブラリに追加されましたが、`std::string`のAPIは`std::string_view`を受けるものはあっても返すものはありません。現在の環境で`std::string`のAPIを設計することを考えると、`std::string_view`を返すことが妥当である関数として`.substr()`が挙げられます。特に、`substr() const &`は即時コピーを必要とするコンテキストではほとんど間違いなく呼び出されません。

現在の`.substr()`の`const`左辺値参照オーバーロードは、部分文字列をコピーして返しています。この戻り値型を`std::string_view`に変更するのは互換性の問題から不可能であるため、この提案では新しいメンバ関数を追加することで部分文字列を`std::string_view`で取得可能にすることを提案しています。

提案しているメンバ関数は`.subview()`という名前です。

```cpp
template<typename charT, typename traits = char_traits<charT>, typename Allocator = allocator<charT>>
struct basic_string {
  ...
  
  // 既存のsubstr()
  constexpr basic_string substr(size_type pos = 0, size_type n = npos) const &;
  constexpr basic_string substr(size_type pos = 0, size_type n = npos) &&;

  // 提案するsubview()
  constexpr basic_string_view<charT, traits> subview(size_type pos = 0, size_type n = npos) const;

  ...

};
```

同時に、`std::string_view`とのAPI一貫性のために、`std::string_view`にもこの`.subview()`を追加することを提案しています。

また、さらにこの関数のcontiguousなコンテナに対する一般化として、`.subspan()`を`array`や`vector`、`string(_view)`に対して追加する方向性を示しており、LEWGはその方向性に興味を持っているようです。

- [P3044 進行状況](https://github.com/cplusplus/papers/issues/1737)

### [P3054R0 2023-12 Library Evolution Poll Outcomes](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3054r0.html)
### [P3079R0 Should ignore and observe exist for constant evaluation of contracts?](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3079r0.pdf)
### [P3084R0 Slides for LEWG views::maybe 20240109](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3084r0.html)
### [P3086R0 Proxy: A Pointer-Semantics-Based Polymorphism Library](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3086r0.pdf)
### [P3087R0 Make direct-initialization for enumeration types at least as permissive as direct-list-initialization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3087r0.html)
